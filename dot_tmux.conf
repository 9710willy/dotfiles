# Prefix: C-a
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# Terminal settings for proper color and italic support
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-256color:Tc"
set -as terminal-overrides ',*:Tc:sitm=\E[3m'

# Enable focus events for autoread in neovim
set -g focus-events on

# Aggressive resize
setw -g aggressive-resize on

# Activity monitoring
set -g monitor-activity on
set -g visual-activity off
setw -g window-status-activity-style 'bg=red,fg=white'

# Bell
set -g bell-action any
set -g visual-bell off

# New windows/panes retain current path
bind c new-window -c "#{pane_current_path}"
bind '"' split-window -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

# Copy to OS clipboard (macOS)
set -g set-clipboard on
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-and-cancel "pbcopy"

# Status bar
set -g status-style 'bg=green,fg=black'
set -g status-justify centre
set -g status-left '#[fg=black,bold] #S #[fg=black]'
set -g status-left-length 20
set -g status-right '#[fg=black]#(pwd | sed "s|$HOME|~|") | %H:%M '
set -g status-right-length 60

# Window status
setw -g window-status-separator ''
setw -g window-status-format '#[fg=black] #I:#W '
setw -g window-status-current-format '#[fg=green,bg=black,bold] #I:#W '
setw -g window-status-activity-style 'fg=white,bg=red,bold'

# Smart pane switching with awareness of Vim splits
# Uses Meta (Alt) + hjkl - consistent with Karabiner hyper key setup
# See: https://github.com/christoomey/vim-tmux-navigator
is_editor="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$|emacs.*$'"
bind -n M-h if-shell "$is_editor" "send-keys M-h" "select-pane -L"
bind -n M-j if-shell "$is_editor" "send-keys M-j" "select-pane -D"
bind -n M-k if-shell "$is_editor" "send-keys M-k" "select-pane -U"
bind -n M-l if-shell "$is_editor" "send-keys M-l" "select-pane -R"
bind -n M-\\ if-shell "$is_editor" "send-keys M-\\" "select-pane -l"
bind -T copy-mode-vi M-h select-pane -L
bind -T copy-mode-vi M-j select-pane -D
bind -T copy-mode-vi M-k select-pane -U
bind -T copy-mode-vi M-l select-pane -R
bind -T copy-mode-vi M-\\ select-pane -l

# Clear screen (since M-l is taken)
bind -n C-] send-keys C-l

# Quick session switching
bind -n M-1 switch-client -t 1
bind -n M-2 switch-client -t 2
bind -n M-3 switch-client -t 3
bind -n M-4 switch-client -t 4
bind -n M-9 switch-client -l  # Last session
bind -n M-[ switch-client -p  # Previous session
bind -n M-] switch-client -n  # Next session

# Claude Code session management
bind C run-shell "~/bin/cc -s"
bind N command-prompt -p "Project path:" "run-shell '~/bin/cc %1'"
bind L run-shell "~/bin/cc -l"

# Key repeat time
set -g repeat-time 200
unbind Up

# Plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Resurrect settings
set -g @resurrect-save 'S'
set -g @resurrect-restore 'R'
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-strategy-vim 'session'

# Auto-restore sessions
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# Initialize TPM (must be last)
run '~/.tmux/plugins/tpm/tpm'
